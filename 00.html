<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通过POST获取图像</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
    <div class="w-full max-w-2xl bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <i class="fa fa-picture-o mr-2 text-blue-500"></i>通过POST请求获取图像
        </h1>
        
        <div class="mb-4">
            <label for="imageName" class="block text-gray-700 mb-2">图像名称:</label>
            <input type="text" id="imageName" 
                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="例如: 20250908000000.jpg" value="20250908000000.jpg">
        </div>
        
        <button id="fetchImage" 
                class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition duration-200 flex items-center">
            <i class="fa fa-download mr-2"></i>获取图像
        </button>
        
        <div id="loading" class="mt-4 hidden">
            <i class="fa fa-spinner fa-spin text-blue-500"></i> 正在获取图像...
        </div>
        
        <div id="error" class="mt-4 text-red-500 hidden"></div>
        
        <div class="mt-6">
            <h2 class="text-lg font-semibold text-gray-700 mb-2">图像预览:</h2>
            <div class="border border-gray-200 rounded-md min-h-[200px] flex items-center justify-center bg-gray-50">
                <img id="imagePreview" src="" alt="图像预览" class="max-w-full max-h-[400px] hidden">
                <span id="noImage" class="text-gray-400">未加载图像</span>
            </div>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const imageNameInput = document.getElementById('imageName');
        const fetchButton = document.getElementById('fetchImage');
        const imagePreview = document.getElementById('imagePreview');
        const noImageText = document.getElementById('noImage');
        const loadingIndicator = document.getElementById('loading');
        const errorElement = document.getElementById('error');

        // 绑定按钮点击事件
        fetchButton.addEventListener('click', fetchImageByPost);

        // 按Enter键也可以触发获取图像
        imageNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fetchImageByPost();
            }
        });

        // 通过POST请求获取图像的函数
        async function fetchImageByPost() {
            const imageName = imageNameInput.value.trim();
            
            if (!imageName) {
                showError('请输入图像名称');
                return;
            }

            // 显示加载状态
            showLoading();
            hideImage();
            hideError();

            try {
                // 发起POST请求
                const response = await fetch('http://localhost:8088/api/getfile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 可以添加其他必要的头信息，如认证信息
                        // 'Authorization': 'Bearer your_token_here'
                    },
                    body: JSON.stringify({ 
                        cameraID:'camera1',
                        date:'25-9-8',
                        filename:'20250908000004.jpg'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }

                // 获取图像二进制数据
                const blob = await response.blob();
                
                // 创建临时URL并显示图像
                const imageUrl = URL.createObjectURL(blob);
                imagePreview.src = imageUrl;
                imagePreview.alt = imageName;
                showImage();

                // 当图像加载完成后释放临时URL
                imagePreview.onload = () => {
                    URL.revokeObjectURL(imageUrl);
                };

            } catch (error) {
                showError(`获取图像失败: ${error.message}`);
                console.error('错误详情:', error);
            } finally {
                hideLoading();
            }
        }

        // 辅助函数 - 显示加载状态
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
        }

        // 辅助函数 - 隐藏加载状态
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }

        // 辅助函数 - 显示图像
        function showImage() {
            imagePreview.classList.remove('hidden');
            noImageText.classList.add('hidden');
        }

        // 辅助函数 - 隐藏图像
        function hideImage() {
            imagePreview.classList.add('hidden');
            noImageText.classList.remove('hidden');
        }

        // 辅助函数 - 显示错误信息
        function showError(message) {
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        // 辅助函数 - 隐藏错误信息
        function hideError() {
            errorElement.textContent = '';
            errorElement.classList.add('hidden');
        }
    </script>
</body>
</html>
